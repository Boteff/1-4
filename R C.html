<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RGB Random Color Generator</title>
  <style>
    body {
      background-color: black;
      color: white;
      text-align: center;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 28px;
      font-weight: bold;
      margin: 20px 0;
    }
    .controls {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .toggle-btn {
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      background-color: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
    }
    .toggle-btn.active {
      background-color: #007acc;
      font-weight: bold;
    }
    .input-group {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }
    input[type="number"] {
      width: 60px;
      padding: 8px;
      font-size: 16px;
      background-color: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background-color: #005a99;
    }
    #colorList {
      list-style: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 600px;
      margin: 20px auto;
    }
    .color-item {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 18px;
      padding: 10px;
      background-color: #111;
      border-radius: 6px;
    }
    .color-swatch {
      width: 40px;
      height: 40px;
      border: 1px solid #444;
      border-radius: 4px;
    }
    .color-value {
      font-family: monospace;
      font-weight: bold;
      color: white;
      white-space: nowrap;
    }
    .distance-control {
      margin: 15px auto;
      max-width: 500px;
      text-align: center;
      padding: 10px;
      background-color: #1a1a1a;
      border-radius: 6px;
    }
    .distance-control label {
      font-size: 16px;
      margin-right: 10px;
    }
    #remainingColors {
      margin-top: 30px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Random Color Generator</h1>

  <div class="controls">
    <button id="hexBtn" class="toggle-btn">HEX</button>
    <button id="rgbBtn" class="toggle-btn">RGB</button>
    <button id="hsbBtn" class="toggle-btn active">HSB</button>
  </div>

  <div class="input-group">
    <label for="countInput">Generate:</label>
    <input type="number" id="countInput" min="1" max="100" value="1">
    <label>colors</label>
  </div>

  <div class="distance-control">
    <label for="distanceInput">Min Color Distance:</label>
    <input type="number" id="distanceInput" min="0" max="100" value="40" style="width: 60px;">
    <div><small>0 = any color, 100 = very different (default: 40)</small></div>
  </div>

  <button onclick="generateColors()">Generate Random Colors</button>
  <button onclick="confirmReset()">Reset All Colors</button>

  <ul id="colorList"></ul>
  <p id="remainingColors">Remaining Colors: 16777216</p>

  <script>
    const totalColors = 16777216;
    let pickedColors = JSON.parse(localStorage.getItem('pickedColors')) || [];
    let minDistance = parseInt(localStorage.getItem('minDistance')) || 40;
    let displayMode = 'HSB';

    const hexBtn = document.getElementById('hexBtn');
    const rgbBtn = document.getElementById('rgbBtn');
    const hsbBtn = document.getElementById('hsbBtn');
    const countInput = document.getElementById('countInput');
    const distanceInput = document.getElementById('distanceInput');
    const colorList = document.getElementById('colorList');
    const remainingEl = document.getElementById('remainingColors');

    distanceInput.value = minDistance;
    distanceInput.addEventListener('change', function () {
      let value = parseInt(this.value);
      if (isNaN(value) || value < 0) value = 0;
      if (value > 100) value = 100;
      this.value = value;
      minDistance = value;
      localStorage.setItem('minDistance', value);
    });

    [hexBtn, rgbBtn, hsbBtn].forEach(btn => {
      btn.addEventListener('click', function () {
        [hexBtn, rgbBtn, hsbBtn].forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        displayMode = this.id === 'hexBtn' ? 'HEX' : this.id === 'rgbBtn' ? 'RGB' : 'HSB';
      });
    });

    function generateColors() {
      const count = parseInt(countInput.value) || 1;
      if (count < 1 || count > 100) return alert("1–100 only.");

      if (pickedColors.length >= totalColors) return alert("All colors used!");

      const newColors = [];
      const maxAttempts = count * 5000;
      let attempts = 0;

      while (newColors.length < count && attempts < maxAttempts) {
        attempts++;
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        const hex = rgbToHex(r, g, b);
        const hsb = rgbToHSB(r, g, b);

        if (pickedColors.some(c => c.hex === hex)) continue;
        if (pickedColors.some(used => hsbDistance(hsb, used.hsb) < minDistance)) continue;

        newColors.push({ r, g, b, hex, hsb });
      }

      if (newColors.length < count) {
        let fallback = count - newColors.length;
        let fAttempts = 0;
        while (fallback > 0 && fAttempts < fallback * 1000) {
          fAttempts++;
          const r = Math.floor(Math.random() * 256);
          const g = Math.floor(Math.random() * 256);
          const b = Math.floor(Math.random() * 256);
          const hex = rgbToHex(r, g, b);
          if (pickedColors.some(c => c.hex === hex)) continue;
          const hsb = rgbToHSB(r, g, b);
          newColors.push({ r, g, b, hex, hsb });
          fallback--;
        }
      }

      if (newColors.length === 0) return alert("No colors available.");

      pickedColors.push(...newColors);
      localStorage.setItem('pickedColors', JSON.stringify(pickedColors));
      updateColorList(newColors);
      updateRemaining();
    }

    function updateColorList(colors) {
      colorList.innerHTML = '';
      colors.forEach(color => {
        const li = document.createElement('li');
        li.className = 'color-item';
        const text = displayMode === 'HEX' ? color.hex :
                     displayMode === 'RGB' ? `RGB(${color.r}, ${color.g}, ${color.b})` :
                     `HSB(${color.hsb.h}°, ${color.hsb.s}%, ${color.hsb.b}%)`;
        li.innerHTML = `<div class="color-swatch" style="background-color: ${color.hex};"></div><span class="color-value">${text}</span>`;
        colorList.appendChild(li);
      });
    }

    function confirmReset() {
      if (confirm("Reset all colors? This cannot be undone.")) resetColors();
    }

    function resetColors() {
      localStorage.removeItem('pickedColors');
      localStorage.removeItem('minDistance');
      pickedColors = [];
      minDistance = 40;
      distanceInput.value = 40;
      colorList.innerHTML = '';
      updateRemaining();
    }

    function updateRemaining() {
      remainingEl.innerText = `Remaining Colors: ${totalColors - pickedColors.length}`;
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
    }

    function rgbToHSB(r, g, b) {
      const [rp, gp, bp] = [r/255, g/255, b/255];
      const max = Math.max(rp, gp, bp), min = Math.min(rp, gp, bp);
      const delta = max - min;
      let h = 0;
      if (delta) {
        if (max === rp) h = ((gp - bp) / delta) % 6;
        else if (max === gp) h = (bp - rp) / delta + 2;
        else h = (rp - gp) / delta + 4;
        h = Math.round(h * 60);
        if (h < 0) h += 360;
      }
      const s = max ? (delta / max) * 100 : 0;
      const bVal = max * 100;
      return { h: Math.round(h), s: Math.round(s), b: Math.round(bVal) };
    }

    function hsbDistance(hsb1, hsb2) {
      const dh = Math.min(Math.abs(hsb1.h - hsb2.h), 360 - Math.abs(hsb1.h - hsb2.h));
      const ds = Math.abs(hsb1.s - hsb2.s);
      const db = Math.abs(hsb1.b - hsb2.b);
      return Math.sqrt(dh * dh + ds * ds + db * db);
    }

    updateRemaining();
  </script>
</body>
</html>