<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.9"/>
<title>Aspect Ratio Calculator</title>

<style>
@font-face {
  font-family: 'MyFont';
  src: url('font.ttf');
}

body {
  text-align: center;
  font-family: MyFont, sans-serif;
  margin: 10px;
}

.container {
  display: inline-block;
  text-align: left;
  width: 300px;
}

input {
  width: 60px;
  padding: 5px;
  font-size: 16px;
  text-align: center;
}

button {
  padding: 5px 8px;
  font-size: 14px;
  cursor: pointer;
  margin: 5px;
}

.calculator-title {
  font-size: 20px;
  font-weight: bold;
  margin: 20px 0 5px;
}

#aspectButtons {
  display: flex;
  justify-content: center;
  gap: 45px;
  margin-top: 10px;
}

.ratioButton {
  font-size: 16px;
  font-weight: bold;
  padding: 5px 10px;
  border: none;
  border-radius: 4px;
  color: white;
  background-color: #ff4d4d;
}

.row {
  margin: 10px 0;
}

.separator {
  border-top: 2px solid #ccc;
  margin: 20px 0;
}

.input-group {
  display: flex;
  align-items: center;
  gap: 10px;
  justify-content: center;
}

#notes {
  margin-top: 20px;
  padding: 10px;
  border: 1px solid #ccc;
  width: 100%;
  height: 150px;
  resize: vertical;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="container">

<!-- Resolution / Aspect Ratio -->
<div class="calculator">
  <div class="calculator-title">Resolution / Aspect Ratio</div>

  <div class="row input-group">
    <strong>Width:</strong>
    <button onclick="adjustWidth(-8)">-</button>
    <input type="number" id="widthR" value="256" oninput="updateRatio()">
    <button onclick="adjustWidth(8)">+</button>
  </div>

  <div class="row input-group">
    <strong>Height:</strong>
    <button onclick="adjustHeight(-8)">-</button>
    <input type="number" id="heightR" value="256" oninput="updateRatio()">
    <button id="heightPlusBtn" onclick="adjustHeight(8)">+ (0)</button>
  </div>

  <div id="aspectButtons">
    <button onclick="setAspectRatio(4,5)">4:5</button>
    <button class="ratioButton" id="ratioButtonR" onclick="resetHeight()">1:1</button>
    <button onclick="setAspectRatio(2,3)">2:3</button>
  </div>
</div>

<div class="separator"></div>

<!-- Resolution Booster -->
<div class="calculator">
  <div class="calculator-title">Resolution Booster</div>

  <div class="row input-group">
    <strong>Aspect Ratio:</strong>
    <input type="text" id="aspectRatio" placeholder="e.g., 16:9" oninput="debouncedCalculateResolution()">
    <button onclick="copyRatio()">Copy Ratio</button>
  </div>

  <div class="row input-group">
    <strong>Default Width:</strong>
    <input type="number" id="defaultWidth" value="400" oninput="calculateResolution(); saveState()">
  </div>

  <div class="row">
    <strong>Calculated Resolution:</strong>
    <span id="calculatedWidth"></span> x <span id="calculatedHeight"></span>
  </div>

  <div class="row input-group">
    <strong>Bump:</strong>
    <button onclick="adjustBump(-8)">-</button>
    <input type="number" id="bumpUpValue" value="8" oninput="saveState()">
    <button onclick="adjustBump(8)">+</button>
    <button onclick="bumpUpResolution()">Bump Up</button>
  </div>
</div>

<div class="separator"></div>

<!-- Notes -->
<div class="calculator">
  <div class="calculator-title">Notes</div>
  <textarea id="notes" oninput="saveState()"></textarea>
</div>

</div>

<script>
const widthR = document.getElementById('widthR');
const heightR = document.getElementById('heightR');
const heightPlusBtn = document.getElementById('heightPlusBtn');

function gcd(a, b) {
  return b === 0 ? a : gcd(b, a % b);
}

/* Width */
function adjustWidth(val) {
  let w = parseInt(widthR.value) + val;
  if (w < 64) w = 64;
  widthR.value = w;
  updateRatio();
}

/* Height */
function adjustHeight(val) {
  let w = parseInt(widthR.value);
  let h = parseInt(heightR.value);
  let min = w;
  let max = w * 2;

  h += val;
  if (h < min) h = min;
  if (h > max) h = max;

  heightR.value = h;
  updateRatio();
}

/* Aspect */
function resetHeight() {
  heightR.value = widthR.value;
  updateRatio();
}

function setAspectRatio(w, h) {
  heightR.value = Math.round(widthR.value * h / w);
  updateRatio();
}

function updateRatio() {
  const w = parseInt(widthR.value);
  const h = parseInt(heightR.value);

  if (w > 0 && h > 0) {
    const d = gcd(w, h);
    ratioButtonR.innerText = `${w/d}:${h/d}`;
  }

  updateHeightButton();
  saveState();
}

/* Height + button label */
function updateHeightButton() {
  const w = parseInt(widthR.value);
  const h = parseInt(heightR.value);
  const max = w * 2;
  const remaining = Math.floor((max - h) / 8);

  heightPlusBtn.innerText =
    remaining <= 0 ? 'MAX' : `+ (${remaining})`;
}

/* Resolution booster */
function calculateResolution() {
  const parts = aspectRatio.value.split(':').map(Number);
  if (parts.length !== 2) return;
  const w = parseInt(defaultWidth.value);
  calculatedWidth.innerText = w;
  calculatedHeight.innerText = Math.round(w * parts[1] / parts[0]);
  saveState();
}

function bumpUpResolution() {
  const parts = aspectRatio.value.split(':').map(Number);
  let w = parseInt(calculatedWidth.innerText);
  w += parseInt(bumpUpValue.value);
  calculatedWidth.innerText = w;
  calculatedHeight.innerText = Math.round(w * parts[1] / parts[0]);
  saveState();
}

function copyRatio() {
  aspectRatio.value = ratioButtonR.innerText;
  calculateResolution();
}

/* Bump */
function adjustBump(v) {
  bumpUpValue.value = Math.max(0, parseInt(bumpUpValue.value) + v);
  saveState();
}

/* Persistence */
function saveState() {
  const data = {};
  document.querySelectorAll('input, textarea, span, button').forEach(el => {
    if (el.id) data[el.id] = el.innerText || el.value;
  });
  localStorage.setItem('state', JSON.stringify(data));
}

function restoreState() {
  const data = JSON.parse(localStorage.getItem('state') || '{}');
  Object.keys(data).forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    if (el.tagName === 'SPAN' || el.tagName === 'BUTTON') el.innerText = data[id];
    else el.value = data[id];
  });
}

/* Debounce */
function debounce(fn, t=200) {
  let timer;
  return (...a) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...a), t);
  };
}

const debouncedCalculateResolution = debounce(calculateResolution);

/* Init */
restoreState();
updateRatio();
</script>

</body>
</html>