<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Random Color Generator</title>

<style>
body{
  background:#121212;
  color:#fff;
  font-family:Arial,sans-serif;
  text-align:center;
  padding:20px;
}
.controls,.input-group{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin:10px 0;
}
.toggle-btn{
  padding:8px 14px;
  background:#333;
  color:#fff;
  border:1px solid #555;
  border-radius:4px;
  cursor:pointer;
}
.toggle-btn.active{
  background:#007acc;
  font-weight:bold;
}
button{
  padding:10px 20px;
  font-size:16px;
  background:#007acc;
  color:white;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover{background:#005a99}
input{
  width:80px;
  padding:6px;
  background:#333;
  color:#fff;
  border:1px solid #555;
  border-radius:4px;
}
#colorList{
  list-style:none;
  padding:0;
  max-width:700px;
  margin:20px auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.color-item{
  display:flex;
  align-items:center;
  gap:15px;
  padding:10px;
  background:#1a1a1a;
  border-radius:6px;
  cursor:pointer;
}
.color-swatch{
  width:40px;
  height:40px;
  border-radius:4px;
  border:1px solid #444;
}
.color-value{
  font-family:monospace;
  font-weight:bold;
}
.hex{opacity:.7;margin-left:10px;}
</style>
</head>

<body>

<h1>Random Color Generator</h1>

<div class="controls">
  <button id="rgbBtn" class="toggle-btn">RGB</button>
  <button id="hsbBtn" class="toggle-btn">HSB</button>
</div>

<div class="input-group">
  <label>Generate</label>
  <input id="countInput" type="number" min="1" max="100" value="1">
  <label>colors</label>
</div>

<div class="controls">
  <label>H</label><input id="hInput" placeholder="0 / x-y / x">
  <label>S</label><input id="sInput" placeholder="0 / x-y / x">
  <label>B</label><input id="bInput" placeholder="0 / x-y / x">
</div>

<div class="controls">
  <button onclick="generateColors()">Generate</button>
  <button id="shuffleToggle" class="toggle-btn">Shuffle OFF</button>
  <button onclick="resetAll()">Reset</button>
</div>

<ul id="colorList"></ul>
<p id="pickedColors"></p>

<script>
/* ========= STATE ========= */
let state = JSON.parse(localStorage.getItem('colorState')) || {
  displayMode: 'HSB',
  lifetimeCount: 0,
  currentBatch: [],
  shuffleOn: false,
  hsbInputs: { h:'', s:'', b:'' }
};

const els = {
  list: document.getElementById('colorList'),
  picked: document.getElementById('pickedColors'),
  rgbBtn: document.getElementById('rgbBtn'),
  hsbBtn: document.getElementById('hsbBtn'),
  shuffleBtn: document.getElementById('shuffleToggle'),
  count: document.getElementById('countInput'),
  h: document.getElementById('hInput'),
  s: document.getElementById('sInput'),
  b: document.getElementById('bInput')
};

/* ========= INIT UI ========= */
els.h.value = state.hsbInputs.h;
els.s.value = state.hsbInputs.s;
els.b.value = state.hsbInputs.b;

[state.rgbBtn, state.hsbBtn];

/* ========= SAVE ========= */
function save(){
  localStorage.setItem('colorState', JSON.stringify(state));
}

/* ========= TOGGLES ========= */
function updateToggles(){
  els.rgbBtn.classList.toggle('active', state.displayMode==='RGB');
  els.hsbBtn.classList.toggle('active', state.displayMode==='HSB');
  els.shuffleBtn.classList.toggle('active', state.shuffleOn);
  els.shuffleBtn.textContent = state.shuffleOn ? 'Shuffle ON' : 'Shuffle OFF';
}
updateToggles();

els.rgbBtn.onclick = () => { state.displayMode='RGB'; save(); redraw(); updateToggles(); };
els.hsbBtn.onclick = () => { state.displayMode='HSB'; save(); redraw(); updateToggles(); };

els.shuffleBtn.onclick = () => {
  state.shuffleOn = !state.shuffleOn;
  if(state.shuffleOn) shuffleVisible();
  save(); updateToggles();
};

/* ========= INPUT PERSIST ========= */
['h','s','b'].forEach(k=>{
  els[k].oninput = () => {
    state.hsbInputs[k] = els[k].value;
    save();
  };
});

/* ========= CRYPTO RANDOM ========= */
function randInt(max){
  const a=new Uint32Array(1);
  crypto.getRandomValues(a);
  return a[0]%max;
}
function randRange(min,max){ return min + randInt(max-min+1); }

/* ========= PARSE ========= */
function parseInput(v,min,max){
  if(!v || v==='0') return randRange(min,max);
  if(v.includes('-')){
    let [a,b] = v.split('-').map(Number);
    return randRange(Math.max(min,a), Math.min(max,b));
  }
  return Math.min(max, Math.max(min, Number(v)));
}

/* ========= SHUFFLE ========= */
function shuffleVisible(){
  let idx = state.currentBatch
    .map((c,i)=>!c.hidden?i:null)
    .filter(i=>i!==null);

  let vis = idx.map(i=>state.currentBatch[i]);
  for(let i=vis.length-1;i>0;i--){
    let j = randInt(i+1);
    [vis[i],vis[j]] = [vis[j],vis[i]];
  }
  idx.forEach((id,i)=>state.currentBatch[id]=vis[i]);
}

/* ========= GENERATE ========= */
function generateColors(){
  let n = parseInt(els.count.value)||1;
  state.currentBatch = [];

  for(let i=0;i<n;i++){
    let r,g,b,h,s,br;
    if(state.displayMode==='HSB'){
      h = parseInput(els.h.value,0,360);
      s = parseInput(els.s.value,0,100);
      br = parseInput(els.b.value,0,100);
      ({r,g,b}=hsbToRGB(h,s,br));
    }else{
      r=randInt(256); g=randInt(256); b=randInt(256);
      ({h,s,b:br}=rgbToHSB(r,g,b));
    }

    state.currentBatch.push({ rgb:{r,g,b}, h,s,b:br, hidden:false });
    state.lifetimeCount++;
  }

  if(state.shuffleOn) shuffleVisible();
  save(); redraw();
}

/* ========= RENDER ========= */
function redraw(){
  els.list.innerHTML='';
  state.currentBatch.forEach((c,i)=>{
    if(c.hidden) return;
    let hex = rgbToHex(c.rgb.r,c.rgb.g,c.rgb.b);
    let txt = state.displayMode==='RGB'
      ? `RGB(${c.rgb.r}, ${c.rgb.g}, ${c.rgb.b})`
      : `HSB(${c.h}Â°, ${c.s}%, ${c.b}%)`;

    els.list.innerHTML += `
      <li class="color-item" onclick="hideColor(${i})">
        <div class="color-swatch" style="background:${hex}"></div>
        <span class="color-value">${txt}<span class="hex">${hex}</span></span>
      </li>`;
  });

  els.picked.textContent = `Total colors picked: ${state.lifetimeCount}`;
}

/* ========= ACTIONS ========= */
function hideColor(i){
  state.currentBatch[i].hidden = true;
  if(state.shuffleOn) shuffleVisible();
  save(); redraw();
}

function resetAll(){
  if(confirm('This will wipe ALL saved data. Continue?')){
    localStorage.removeItem('colorState');
    location.reload();
  }
}

/* ========= COLOR MATH ========= */
function rgbToHex(r,g,b){
  return '#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('').toUpperCase();
}
function rgbToHSB(r,g,b){
  r/=255;g/=255;b/=255;
  let m=Math.max(r,g,b),n=Math.min(r,g,b),d=m-n,h=0;
  if(d){
    if(m===r)h=((g-b)/d)%6;
    else if(m===g)h=(b-r)/d+2;
    else h=(r-g)/d+4;
    h=Math.round(h*60); if(h<0)h+=360;
  }
  return { h, s:m?Math.round(d/m*100):0, b:Math.round(m*100) };
}
function hsbToRGB(h,s,b){
  s/=100; b/=100;
  let c=b*s,x=c*(1-Math.abs((h/60)%2-1)),m=b-c;
  let r=0,g=0,bl=0;
  if(h<60){r=c;g=x;}
  else if(h<120){r=x;g=c;}
  else if(h<180){g=c;bl=x;}
  else if(h<240){g=x;bl=c;}
  else if(h<300){r=x;bl=c;}
  else{r=c;bl=x;}
  return {
    r:Math.round((r+m)*255),
    g:Math.round((g+m)*255),
    b:Math.round((bl+m)*255)
  };
}

/* INIT */
updateToggles();
redraw();
</script>

</body>
</html>